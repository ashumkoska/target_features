<?xml version="1.0" encoding="utf-8"?>

<openerp>
    <data>
    
        <!-- Views -->
        <record id="view_sale_order_target_form" model="ir.ui.view">
            <field name="name">sale.order.target.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <field name="second_approval" invisible="1"/>
                    <field name="discount_approved" invisible="1"/>
                </xpath>
                <xpath expr="//button[@name='action_quotation_send']" position="before">
                    <button name="action_approve_quot" string="Approve Quotation" type="object"
                            class="oe_highlight" attrs="{'invisible': ['|', ('second_approval', '=', False), ('state', '!=', 'waiting_approval')]}"
                            groups="target_features.role_target_manager_res_groups"/>
                </xpath>
                <xpath expr="//button[@name='action_quotation_send']" position="attributes">
                    <attribute name="states">draft,approved,waiting_approval</attribute>
                </xpath>
                <xpath expr="//button[@name='print_quotation']" position="attributes">
                    <attribute name="states">draft,approved,waiting_approval</attribute>
                </xpath>
                <xpath expr="//button[@name='action_button_confirm']" position="attributes">
                    <attribute name="states">draft,approved</attribute>
                </xpath>
                <xpath expr="//button[@name='cancel']" position="attributes">
                    <attribute name="states">draft,approved,sent,waiting_approval</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_sale_order_target_sales_form" model="ir.ui.view">
            <field name="name">sale.order.target.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="groups_id" eval="[(4, ref('target_features.role_target_sales_res_groups'))]"/>
            <field name="priority">17</field>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_button_confirm']" position="attributes">
                    <attribute name="states">approved</attribute>
                    <attribute name="attrs">{'invisible': [('second_approval', '=', True), ('discount_approved', '=', False)]}</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_sale_order_target_tree" model="ir.ui.view">
            <field name="name">sale.order.target.tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="attributes">
                    <attribute name="colors">grey:state=='cancel';blue:state in ('waiting_date','manual');red:state in ('invoice_except','shipping_except');green:state in ('waiting_approval');</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_contract_target_form" model="ir.ui.view">
            <field name="name">contract.target.form</field>
            <field name="model">account.analytic.account</field>
            <field name="inherit_id" ref="analytic.view_account_analytic_account_form"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='main']" position="after">
                    <group name="user_info">
                        <group>
                            <field name="username"/>
                            <field name="password"/>
                        </group>
                        <group>
                            <button name="send_activation_mail" string="Send Activation Email" type="object" class="oe_highlight"/>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>
        
        <record id="view_res_partner_target_form" model="ir.ui.view">
            <field name="name">res.partner.target.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='title']" position="after">
                    <field name="partner_url" widget="url"/>
                </xpath>
                <xpath expr="//notebook" position="inside">
                    <page string="Old Notes">
                        <field name="old_notes"/>
                    </page>
                </xpath>
                <xpath expr="//field[@name='function']" position="replace">
                    <field name="note_ids" widget="many2many_tags"/>
                </xpath>
            </field>
        </record>
        
        <!-- Stat Buttons invisible for Farmer -->
        <record id="view_res_partner_target_farmer_form" model="ir.ui.view">
            <field name="name">res.partner.target.farmer.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="sale.res_partner_view_buttons"/>
            <field name="groups_id" eval="[(4, ref('target_features.role_target_farmer_res_groups'))]"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@name='buttons']" position="replace">
                    <div class="oe_right oe_button_box" name="buttons">
                        <button class="oe_inline oe_stat_button" type="object" name="schedule_meeting" icon="fa-calendar" context="{'partner_id': active_id}">
                            <field string="Meetings" name="meeting_count" widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" type="action" name="135" icon="fa-phone" context="{'search_default_partner_id': active_id, 'default_duration': 1.0}">
                            <field string="Calls" name="phonecall_count" widget="statinfo"/>
                        </button>
                    </div>                    
                </xpath>
            </field>
        </record>
        
        <record id="view_res_partner_so_target_farmer_form" model="ir.ui.view">
            <field name="name">res.partner.so.target.farmer.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="sale.res_partner_view_buttons"/>
            <field name="groups_id" eval="[(4, ref('target_features.role_target_farmer_res_groups'))]"/>
            <field name="arch" type="xml">
                <xpath expr="//button[1]" position="attributes">
                    <attribute name="invisible">1</attribute>               
                </xpath>
            </field>
        </record>
        
        <record id="view_crm_lead_target_form" model="ir.ui.view">
            <field name="name">crm.lead.form</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="marketing_crm.view_crm_lead_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='source_id']" position="before">
                    <field name="source_readonly" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='source_id']" position="attributes">
                    <attribute name="attrs">{'readonly': [('source_readonly', '=', True)]}</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_crm_lead_target_farmer_form" model="ir.ui.view">
            <field name="name">crm.lead.farmer.form</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="marketing_crm.view_crm_lead_form"/>
            <field name="groups_id" eval="[(4, ref('target_features.role_target_farmer_res_groups'))]"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='user_id']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>
                <xpath expr="//field[@name='section_id']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_crm_lead_only_target_form" model="ir.ui.view">
            <field name="name">crm.lead.only.form</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>            
            <field name="arch" type="xml">
                <xpath expr="//button[1]" position="replace">
                    <button name="%(crm.action_crm_lead2opportunity_partner)d" string="Convert to Opportunity" type="action"
                            help="Convert to Opportunity" class="oe_highlight" groups="target_features.role_target_sales_res_groups"/>
                </xpath>
            </field>
        </record>
        
        <record id="view_crm_lead_target_search" model="ir.ui.view">
            <field name="name">crm.own.leads.search</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[1]" position="attributes">
                    <attribute name="name">my_leads</attribute>
                </xpath>
            </field>
        </record>
        
        <record id="view_crm_case_stage_target_form" model="ir.ui.view">
            <field name="name">crm.case.stage.form</field>
            <field name="model">crm.case.stage</field>
            <field name="inherit_id" ref="crm.crm_case_stage_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='case_default']" position="after">
                    <field name="farmer_visible"/>
                </xpath>
            </field>
        </record>
        
        <record id="view_account_invoice_target_form" model="ir.ui.view">
            <field name="name">account.invoice.target.form</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='invoice_open']" position="attributes">
                    <attribute name="groups">target_features.role_target_accountant_res_groups,target_features.role_target_manager_res_groups</attribute>
                </xpath>
            </field>
        </record>
        
        <!-- Actions -->
        <record id="sale.action_quotations" model="ir.actions.act_window">
            <field name="domain">[('state','in',('draft', 'waiting_approval', 'approved', 'sent', 'cancel'))]</field>
        </record>
        <record id="crm.crm_case_category_act_leads_all" model="ir.actions.act_window">
            <field name="context">{'default_type': 'lead', 'stage_type': 'lead', 'needaction_menu_ref': 'crm.menu_crm_opportunities', 'search_default_my_leads': 1}</field>
        </record>
            
    </data>            
</openerp>
